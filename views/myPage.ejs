<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Íµ¨Ïù¥ÍπÄ&ÎÆ§ÏßÅÏä§ - My Page</title>
    <link rel="stylesheet" href="../public/css/myPage.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <%- include('./common/header') %>
        <main>
            <section class="profile-section">
                <img src="<%= user.properties.profile_image %>" alt="Profile Picture" class="profile-image">
                <div class="profile-info">
                    <h1>
                        <%= user.properties.nickname %>
                    </h1>
                    <p>Premium Member since 2023</p>
                    <div class="profile-stats">
                        <div class="stat">
                            <div class="stat-value">
                                <%= playlistAndSongs.length %>
                            </div>
                            <div class="stat-label">Playlists</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">
                                <%= count %>
                            </div>
                            <div class="stat-label">Liked Songs</div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 1vw; margin-left: auto;">
                    <a href="#" class="edit-profile">ÎÇ¥ Ï†ïÎ≥¥ ÏàòÏ†ï</a>
                    <a class="createPlaylistBtn edit-profile">ÏÉà ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ ÏÉùÏÑ±</a>
                </div>
            </section>

            <div class="tabs">
                <div class="tab active" data-tab="playlists">My Playlists</div>
            </div>
            <div class="tab-content active" id="playlists">

                <div class="playlist-grid">
                    <% for(let i=0; i < playlistAndSongs.length; i++) { %>
                        <div class="playlist-card" data-playlist-id="<%= playlistAndSongs[i].name %>">
                            <img src="../public/images/musicimages/<%= playlistAndSongs[i].songs[0].songImg %>">
                            <div class="playlist-info">
                                <h3>
                                    <%= playlistAndSongs[i].name %>
                                </h3>
                            </div>
                        </div>
                        <% } %>
                </div>
            </div>
        </main>

        <!-- ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ ÌåùÏóÖ -->
        <div class="popup-overlay" id="playlist-popup-overlay">
            <div class="playlist-popup">
                <div class="popup-header">
                    <img src="../public/images/logo_seaweed.png" alt="Playlist Cover" class="popup-cover"
                        id="popup-cover">
                    <div class="popup-header-info">
                        <div>
                            <h2 class="playlist-title" id="popup-title">ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ Ï†úÎ™©</h2>
                            <p class="playlist-meta" id="popup-meta">ÏÉùÏÑ±Ïùº: 2023ÎÖÑ 7Ïõî 15Ïùº ‚Ä¢ 15Í≥° ‚Ä¢ 59Î∂Ñ</p>
                            <div class="playlist-creator">
                                <img src="<%= user.properties.profile_image %>" alt="Creator" class="creator-avatar">
                                <span id="popup-creator">
                                    <%= user.properties.nickname %>
                                </span>
                            </div>
                        </div>
                        <div class="playlist-action-buttons">
                            <button class="playlist-action play-btn" id="play_playlist_btn">
                                <span>‚ñ∂</span> Ïû¨ÏÉù
                            </button>
                            <button class="playlist-action add-songs-btn" id="add-songs-toggle">
                                <span>+</span> Í≥° Ï∂îÍ∞Ä
                            </button>
                            <button class="playlist-action start-streaming-btn">
                                <span>‚óè</span> Ïä§Ìä∏Î¶¨Î∞ç ÏãúÏûë
                            </button>
                            <button class="playlist-action delete-playlist-btn" id="delete_playlist_btn">
                                <span>üóëÔ∏è</span> ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ ÏÇ≠Ï†ú
                            </button>
                        </div>
                    </div>
                    <button class="close-popup" id="close-popup">‚úï</button>
                </div>

                <div class="popup-body">
                    <div class="add-song-form" id="add-song-form">
                        <h3 class="form-title">ÏÉà ÎÖ∏Îûò Ï∂îÍ∞ÄÌïòÍ∏∞</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <form action="/mypage/search" method="get" class="search-bar" id="search-bar2">
                                    <input type="text" id="new-song-title2" placeholder="Ï†úÎ™© ÌòπÏùÄ ÏïÑÌã∞Ïä§Ìä∏ Ïù¥Î¶ÑÏúºÎ°ú Í≤ÄÏÉâ">
                                </form>
                            </div>
                        </div>
                        <div id="form_content"></div>
                    </div>
                    <ul class="playlist-songs" id="playlist-songs">
                    </ul>
                </div>
            </div>
        </div>

        <!-- ÏÉà ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ ÏÉùÏÑ± ÌåùÏóÖ -->
        <div class="create-playlist-overlay" id="create-playlist-overlay">
            <div class="create-playlist-popup">
                <div class="create-playlist-header">
                    <h2 class="create-playlist-title">ÏÉà ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ ÏÉùÏÑ±</h2>
                    <div class="create-playlist-form">
                        <input type="text" id="new-playlist-name" class="create-playlist-input"
                            placeholder="ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    <button class="close-create-popup" id="close-create-popup">‚úï</button>
                </div>

                <div class="create-playlist-body">
                    <div class="songs-section">
                        <div class="add-song-form" id="add-song-to-new-form">
                            <h3 class="form-title">ÏÉà ÎÖ∏Îûò Ï∂îÍ∞ÄÌïòÍ∏∞</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <form action="/mypage/search" method="get" class="search-bar" id="search-bar">
                                        <input type="text" id="new-song-title" placeholder="Ï†úÎ™© ÌòπÏùÄ ÏïÑÌã∞Ïä§Ìä∏ Ïù¥Î¶ÑÏúºÎ°ú Í≤ÄÏÉâ">
                                    </form>
                                </div>
                            </div>
                            <div id="form_content_new"></div>
                        </div>
                        <ul class="playlist-songs" id="create-playlist-songs">
                            <div class="empty-songs-message">ÏïÑÏßÅ Ï∂îÍ∞ÄÎêú Í≥°Ïù¥ ÏóÜÏäµÎãàÎã§. Í≥°ÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.</div>
                        </ul>
                    </div>
                </div>

                <div class="create-playlist-actions">
                    <button class="add-song-to-new-btn" id="add-song-to-new-toggle">
                        + Í≥° Ï∂îÍ∞Ä
                    </button>
                    <button class="create-playlist-btn" id="create-playlist-btn" disabled>
                        ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ ÏÉùÏÑ±
                    </button>
                </div>
            </div>
        </div>

        <!-- ÎÇ¥ Ï†ïÎ≥¥ ÏàòÏ†ï ÌåùÏóÖ -->
        <div class="edit-profile-overlay" id="edit-profile-overlay">
            <div class="edit-profile-popup">
                <div class="edit-profile-header">
                    <h2 class="edit-profile-title">ÎÇ¥ Ï†ïÎ≥¥ ÏàòÏ†ï</h2>
                    <button class="close-edit-popup" id="close-edit-popup">‚úï</button>
                </div>
                <div class="edit-profile-body">
                    <form id="editProf">
                        <div class="form-group">
                            <label for="new-nickname">ÎãâÎÑ§ÏûÑ ÏàòÏ†ï</label>
                            <input type="text" name="new_nickname" class="edit-profile-input"
                                value="<%= user.properties.nickname %>" required>
                        </div>
                        <div class="form-group">
                            <label for="new-profile-image">ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ Î≥ÄÍ≤Ω</label>
                            <input type="file" id="profile" name="new_profile_image" class="edit-profile-input"
                                style="display: none;">
                            <div class="image-preview" id="image-preview">
                                <label for="profile">
                                    <img src="<%= user.properties.profile_image %>" alt="Profile Image Preview"
                                        id="preview_image"
                                        style="width: 100px; height: 100px; border-radius: 50%; cursor: pointer;">
                                </label>
                            </div>
                        </div>
                        <div class="edit-profile-actions">
                            <button class="update-profile-btn" id="update-profile-btn">
                                Ï†ÅÏö©
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ïà®Í∏¥ Ïò§ÎîîÏò§ ------------------------------------------------>
        <audio id="audio" src="" style="display: none;"></audio>




        <div id="custom-player">
            <div class="player-left">
                <img id="player-img" src="" alt="Ïï®Î≤î Ïª§Î≤Ñ">
                <div class="player-info">
                    <div id="player-title"></div>
                    <div id="player-artist"></div>
                </div>
                <div class="player-times">
                    <span id="current_time"></span> / <span id="duration"></span>
                </div>
            </div>

            <div class="player-center">
                <div>
                    <button id="prev_btn">‚èÆÔ∏è</button>
                    <button id="play_pause_btn">‚ñ∂Ô∏è</button>
                    <button id="next_btn">‚è≠Ô∏è</button>
                </div>
                <div>
                    <input type="range" id="seek_bar" value="0" min="0" max="100">
                </div>
            </div>

            <input type="range" id="volume-bar" min="0" max="1" step="0.01" value="0.5">
        </div>
        </div>





        <%- include('common/footer')%>
</body>
<script src="../public/js/myPage.js"></script>

</html>